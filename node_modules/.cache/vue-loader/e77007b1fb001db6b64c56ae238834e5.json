{"remainingRequest":"D:\\文件类\\QQ个人文件\\631630579\\FileRecv\\实训\\ync\\ync\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\文件类\\QQ个人文件\\631630579\\FileRecv\\实训\\ync\\ync\\src\\pages\\index\\current-session\\index.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"D:\\文件类\\QQ个人文件\\631630579\\FileRecv\\实训\\ync\\ync\\src\\pages\\index\\current-session\\index.vue","mtime":1594701267866},{"path":"D:\\文件类\\QQ个人文件\\631630579\\FileRecv\\实训\\ync\\ync\\node_modules\\css-loader\\index.js","mtime":1594520318482},{"path":"D:\\文件类\\QQ个人文件\\631630579\\FileRecv\\实训\\ync\\ync\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1594520321696},{"path":"D:\\文件类\\QQ个人文件\\631630579\\FileRecv\\实训\\ync\\ync\\node_modules\\postcss-loader\\src\\index.js","mtime":1594520320719},{"path":"D:\\文件类\\QQ个人文件\\631630579\\FileRecv\\实训\\ync\\ync\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1594520317844},{"path":"D:\\文件类\\QQ个人文件\\631630579\\FileRecv\\实训\\ync\\ync\\node_modules\\vue-loader\\lib\\index.js","mtime":1594520321695}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.current-session{\r\n\tdisplay: flex;\r\n}\r\n\r\n\r\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgFA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/index/current-session","sourcesContent":["<template>\r\n\t<div class=\"current-session\">\r\n\t\t<session-list type=\"current\" @selectedSession=\"noticeWindow\" :sessionList=\"sessionList\"></session-list>\r\n\t\t<session-window :session=\"session\" :msgs=\"msgs\" :socket=\"socket\"></session-window>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\timport SessionList from '../components/SessionList.vue'\r\n\timport SessionWindow from '../components/SessionWindow.vue'\r\n\t\r\n\texport default{\r\n\t\tname:\"CurrentSession\",\r\n\t\tcomponents:{\r\n\t\t\tSessionList,SessionWindow\r\n\t\t},\r\n\t\tdata:function(){\r\n\t\t\treturn {\r\n\t\t\t\tsession:null,\r\n\t\t\t\tsocket:null,\r\n\t\t\t\tsessionList:[],\r\n\t\t\t\tmsgs:[]\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\tnoticeWindow:function(session){\r\n\t\t\t\tthis.session = session;\r\n\t\t\t\tthis.msgs=[]\r\n\t\t\t},\r\n\t\t\tinitWebsocket:function(){\r\n\t\t\t\tif(typeof(WebSocket) == \"undefined\") {\r\n\t\t\t\t    console.log(\"您的浏览器不支持WebSocket\");\r\n\t\t\t\t}else{\r\n\t\t\t\t    console.log(\"您的浏览器支持WebSocket\");\r\n\t\t\t\t    //实现化WebSocket对象，指定要连接的服务器地址与端口  建立连接\r\n\t\t\t\t    var userId = JSON.parse(localStorage.getItem(\"user\")).id;\r\n\t\t\t\t    var socketUrl=\"ws://localhost:8080/ccs/webSocket/\"+userId+\"/cs\";\r\n\t\t\t\t    // var socketUrl=\"ws://192.168.0.231:22599/webSocket/\"+userId;\r\n\t\t\t\t    console.log(socketUrl);\r\n\t\t\t\t    if(this.socket!=null){\r\n\t\t\t\t        this.socket.close();\r\n\t\t\t\t        this.socket=null;\r\n\t\t\t\t    }\r\n\t\t\t\t    this.socket = new WebSocket(socketUrl);\r\n\t\t\t\t    //打开事件\r\n\t\t\t\t    this.socket.onopen = function() {\r\n\t\t\t\t        console.log(\"websocket已打开\");\r\n\t\t\t\t        //socket.send(\"这是来自客户端的消息\" + location.href + new Date());\r\n\t\t\t\t    };\r\n\t\t\t\t    //获得消息事件\r\n\t\t\t\t    this.socket.onmessage = (resp)=>{\r\n\t\t\t\t\t\tlet data = JSON.parse(resp.data);\r\n\t\t\t\t\t\tif(data.type){\r\n\t\t\t\t\t\t\tthis.sessionList = data.sessionList;\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tthis.msgs.push(data);\r\n\t\t\t\t\t\t\tconsole.log(this.msgs);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// console.log(this.sessionList)\r\n\t\t\t\t        //当接收到websocket服务器发送当消息当时候，判断消息是会话列表有更新还是会话消息有更新，更新对应当子组件\r\n\t\t\t\t    };\r\n\t\t\t\t    //关闭事件\r\n\t\t\t\t    this.socket.onclose = function() {\r\n\t\t\t\t        console.log(\"websocket已关闭\");\r\n\t\t\t\t    };\r\n\t\t\t\t    //发生了错误事件\r\n\t\t\t\t    this.socket.onerror = function() {\r\n\t\t\t\t        console.log(\"websocket发生了错误\");\r\n\t\t\t\t    }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\t// 当页面显示后，客服应该连接websocket\r\n\t\t\tthis.initWebsocket();\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n.current-session{\r\n\tdisplay: flex;\r\n}\r\n\r\n\r\n</style>\r\n"]}]}