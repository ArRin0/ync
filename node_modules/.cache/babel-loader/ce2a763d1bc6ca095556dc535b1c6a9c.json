{"remainingRequest":"D:\\文件类\\QQ个人文件\\631630579\\FileRecv\\实训\\ync\\ync\\node_modules\\babel-loader\\lib\\index.js!D:\\文件类\\QQ个人文件\\631630579\\FileRecv\\实训\\ync\\ync\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\文件类\\QQ个人文件\\631630579\\FileRecv\\实训\\ync\\ync\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\文件类\\QQ个人文件\\631630579\\FileRecv\\实训\\ync\\ync\\src\\pages\\visitor\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\文件类\\QQ个人文件\\631630579\\FileRecv\\实训\\ync\\ync\\src\\pages\\visitor\\index.vue","mtime":1594688849256},{"path":"D:\\文件类\\QQ个人文件\\631630579\\FileRecv\\实训\\ync\\ync\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1594520317844},{"path":"D:\\文件类\\QQ个人文件\\631630579\\FileRecv\\实训\\ync\\ync\\node_modules\\babel-loader\\lib\\index.js","mtime":1594520317662},{"path":"D:\\文件类\\QQ个人文件\\631630579\\FileRecv\\实训\\ync\\ync\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1594520317844},{"path":"D:\\文件类\\QQ个人文件\\631630579\\FileRecv\\实训\\ync\\ync\\node_modules\\vue-loader\\lib\\index.js","mtime":1594520321695}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport UaParser from 'ua-parser-js';\n\nrequire(\"../../utils/date.js\"); //加载扩展Date的文件\n\n\nexport default {\n  name: \"GVisitor\",\n  data: function data() {\n    return {\n      socket: null,\n      userId: null,\n      name: null,\n      csId: null,\n      msgs: [],\n      content: ''\n    };\n  },\n  methods: {\n    initWebsocket: function initWebsocket() {\n      var _this = this;\n\n      if (typeof WebSocket == \"undefined\") {\n        console.log(\"您的浏览器不支持WebSocket\");\n      } else {\n        console.log(\"您的浏览器支持WebSocket\"); //实现化WebSocket对象，指定要连接的服务器地址与端口  建立连接\n        // var userId = JSON.parse(localStorage.getItem(\"user\")).id;\n\n        var socketUrl = \"ws://localhost:8080/ccs/webSocket/\" + this.userId + \"/visitor\"; // var socketUrl=\"ws://192.168.0.231:22599/webSocket/\"+userId;\n\n        console.log(socketUrl);\n\n        if (this.socket != null) {\n          this.socket.close();\n          this.socket = null;\n        }\n\n        this.socket = new WebSocket(socketUrl); //打开事件\n\n        this.socket.onopen = function () {\n          console.log(\"websocket已打开\"); //socket.send(\"这是来自客户端的消息\" + location.href + new Date());\n        }; //获得消息事件\n\n\n        this.socket.onmessage = function (resp) {\n          debugger; //当接收到websocket服务器发送当消息当时候，判断消息是会话列表有更新还是会话消息有更新，更新对应当子组件\n\n          var msg = JSON.parse(resp.data);\n\n          _this.msgs.push(msg);\n\n          if (msg.csId) {\n            //第一次连接的时候，websocket服务器会返回服务的客服id\n            _this.csId = msg.csId;\n          }\n\n          if (msg.sessionId) {\n            //第一次连接的时候，websocket服务器会返回会话id\n            _this.sessionId = msg.sessionId;\n          }\n        }; //关闭事件\n\n\n        this.socket.onclose = function () {\n          console.log(\"websocket已关闭\");\n        }; //发生了错误事件\n\n\n        this.socket.onerror = function () {\n          console.log(\"websocket发生了错误\");\n        };\n      }\n    },\n    getId: function getId() {\n      var _this2 = this;\n\n      // 将客户端信息：IP,客户名称，浏览器，屏幕尺寸，设备等信息提交给服务器，服务器返回当前的访客 id\n      var ip = localStorage.getItem(\"ip\");\n      var name = this.name = localStorage.getItem(\"cname\");\n      var uaParser = new UaParser();\n      var uaInfo = uaParser.getResult();\n      var device = uaInfo.os.name;\n      var browser = uaInfo.browser.name;\n      var screenSize = \"\".concat(window.screen.width, \"px*\").concat(window.screen.height, \"px\");\n      var params = {\n        ip: ip,\n        name: name,\n        browser: browser,\n        screenSize: screenSize,\n        device: device\n      };\n      this.$axios.post('/visitor/save', params).then(function (resp) {\n        var data = resp.data;\n        _this2.userId = data.success ? data.message : \"\";\n\n        _this2.initWebsocket();\n      }).catch(function (err) {\n        console.log(err);\n      });\n    },\n    sendMsg: function sendMsg() {\n      var msg = {\n        content: this.content,\n        msgSenderId: this.userId,\n        msgSenderName: this.name,\n        msgReceiverId: this.csId,\n        sessionId: this.sessionId,\n        createTime: new Date().format('yyyy-MM-dd hh:mm:ss')\n      };\n      this.socket.send(JSON.stringify(msg));\n      this.msgs.push(msg);\n      this.content = '';\n    }\n  },\n  created: function created() {\n    this.getId();\n  }\n};",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA,OAAA,QAAA,MAAA,cAAA;;AACA,OAAA,uBAAA,C,CAAA;;;AACA,eAAA;AACA,EAAA,IAAA,EAAA,UADA;AAEA,EAAA,IAAA,EAAA,gBAAA;AACA,WAAA;AACA,MAAA,MAAA,EAAA,IADA;AAEA,MAAA,MAAA,EAAA,IAFA;AAGA,MAAA,IAAA,EAAA,IAHA;AAIA,MAAA,IAAA,EAAA,IAJA;AAKA,MAAA,IAAA,EAAA,EALA;AAMA,MAAA,OAAA,EAAA;AANA,KAAA;AAQA,GAXA;AAYA,EAAA,OAAA,EAAA;AACA,IAAA,aAAA,EAAA,yBAAA;AAAA;;AACA,UAAA,OAAA,SAAA,IAAA,WAAA,EAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,mBAAA;AACA,OAFA,MAEA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,kBAAA,EADA,CAEA;AACA;;AACA,YAAA,SAAA,GAAA,uCAAA,KAAA,MAAA,GAAA,UAAA,CAJA,CAKA;;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,SAAA;;AACA,YAAA,KAAA,MAAA,IAAA,IAAA,EAAA;AACA,eAAA,MAAA,CAAA,KAAA;AACA,eAAA,MAAA,GAAA,IAAA;AACA;;AACA,aAAA,MAAA,GAAA,IAAA,SAAA,CAAA,SAAA,CAAA,CAXA,CAYA;;AACA,aAAA,MAAA,CAAA,MAAA,GAAA,YAAA;AACA,UAAA,OAAA,CAAA,GAAA,CAAA,cAAA,EADA,CAEA;AACA,SAHA,CAbA,CAiBA;;;AACA,aAAA,MAAA,CAAA,SAAA,GAAA,UAAA,IAAA,EAAA;AACA,mBADA,CAEA;;AACA,cAAA,GAAA,GAAA,IAAA,CAAA,KAAA,CAAA,IAAA,CAAA,IAAA,CAAA;;AACA,UAAA,KAAA,CAAA,IAAA,CAAA,IAAA,CAAA,GAAA;;AACA,cAAA,GAAA,CAAA,IAAA,EAAA;AAAA;AACA,YAAA,KAAA,CAAA,IAAA,GAAA,GAAA,CAAA,IAAA;AACA;;AACA,cAAA,GAAA,CAAA,SAAA,EAAA;AAAA;AACA,YAAA,KAAA,CAAA,SAAA,GAAA,GAAA,CAAA,SAAA;AACA;AACA,SAXA,CAlBA,CA8BA;;;AACA,aAAA,MAAA,CAAA,OAAA,GAAA,YAAA;AACA,UAAA,OAAA,CAAA,GAAA,CAAA,cAAA;AACA,SAFA,CA/BA,CAkCA;;;AACA,aAAA,MAAA,CAAA,OAAA,GAAA,YAAA;AACA,UAAA,OAAA,CAAA,GAAA,CAAA,gBAAA;AACA,SAFA;AAGA;AACA,KA3CA;AA4CA,IAAA,KAAA,EAAA,iBAAA;AAAA;;AACA;AACA,UAAA,EAAA,GAAA,YAAA,CAAA,OAAA,CAAA,IAAA,CAAA;AACA,UAAA,IAAA,GAAA,KAAA,IAAA,GAAA,YAAA,CAAA,OAAA,CAAA,OAAA,CAAA;AAEA,UAAA,QAAA,GAAA,IAAA,QAAA,EAAA;AACA,UAAA,MAAA,GAAA,QAAA,CAAA,SAAA,EAAA;AACA,UAAA,MAAA,GAAA,MAAA,CAAA,EAAA,CAAA,IAAA;AACA,UAAA,OAAA,GAAA,MAAA,CAAA,OAAA,CAAA,IAAA;AACA,UAAA,UAAA,aAAA,MAAA,CAAA,MAAA,CAAA,KAAA,gBAAA,MAAA,CAAA,MAAA,CAAA,MAAA,OAAA;AAEA,UAAA,MAAA,GAAA;AACA,QAAA,EAAA,EAAA,EADA;AAEA,QAAA,IAAA,EAAA,IAFA;AAGA,QAAA,OAAA,EAAA,OAHA;AAIA,QAAA,UAAA,EAAA,UAJA;AAKA,QAAA,MAAA,EAAA;AALA,OAAA;AAOA,WAAA,MAAA,CACA,IADA,CACA,eADA,EACA,MADA,EAEA,IAFA,CAEA,UAAA,IAAA,EAAA;AAAA,YACA,IADA,GACA,IADA,CACA,IADA;AAEA,QAAA,MAAA,CAAA,MAAA,GAAA,IAAA,CAAA,OAAA,GAAA,IAAA,CAAA,OAAA,GAAA,EAAA;;AACA,QAAA,MAAA,CAAA,aAAA;AACA,OANA,EAOA,KAPA,CAOA,UAAA,GAAA,EAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,GAAA;AACA,OATA;AAWA,KAzEA;AA0EA,IAAA,OAAA,EAAA,mBAAA;AACA,UAAA,GAAA,GAAA;AACA,QAAA,OAAA,EAAA,KAAA,OADA;AAEA,QAAA,WAAA,EAAA,KAAA,MAFA;AAGA,QAAA,aAAA,EAAA,KAAA,IAHA;AAIA,QAAA,aAAA,EAAA,KAAA,IAJA;AAKA,QAAA,SAAA,EAAA,KAAA,SALA;AAMA,QAAA,UAAA,EAAA,IAAA,IAAA,GAAA,MAAA,CAAA,qBAAA;AANA,OAAA;AAQA,WAAA,MAAA,CAAA,IAAA,CAAA,IAAA,CAAA,SAAA,CAAA,GAAA,CAAA;AACA,WAAA,IAAA,CAAA,IAAA,CAAA,GAAA;AACA,WAAA,OAAA,GAAA,EAAA;AACA;AAtFA,GAZA;AAoGA,EAAA,OApGA,qBAoGA;AACA,SAAA,KAAA;AACA;AAtGA,CAAA","sourcesContent":["<template>\r\n\t<div class=\"session-main-body\">\r\n\t\t<div class=\"title\"><h3>七尾~在线客服</h3></div>\r\n\t\t<div class=\"session-window\">\r\n\t\t\t<div class=\"session-msg sender\" v-for=\"msg in msgs\" :key=\"msg.id\">\r\n\t\t\t\t<div class=\"user-img\">\r\n\t\t\t\t\t<i class=\"iconfont icon-beizit\"></i>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"msg-detail\">\r\n\t\t\t\t\t<div class=\"msg-title\">\r\n\t\t\t\t\t\t<span class=\"user-name\">{{msg.visitorName}}</span>\r\n\t\t\t\t\t\t<span class=\"msg-time\">{{msg.time}}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"msg-content\">{{msg.content}}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"session-input\">\r\n\t\t\t<div class=\"icon-img\">\r\n\t\t\t\t<span class=\"icon\"><i class=\"iconfont icon-xiaolian1\"></i></span>\r\n\t\t\t\t<span class=\"file\"><i class=\"iconfont icon-tupian\"></i></span>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"input-box\">\r\n\t\t\t\t<textarea id=\"msg\" placeholder=\"请输入内容\" v-model=\"content\">\r\n\t\r\n\t\t\t\t</textarea>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"input-btn\">\r\n\t\t\t\t<button type=\"button\" @click=\"sendMsg\">发送</button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\timport UaParser from 'ua-parser-js';\r\n\trequire('../../utils/date.js')//加载扩展Date的文件\r\n\texport default{\r\n\t\tname:\"GVisitor\",\r\n\t\tdata:function(){\r\n\t\t\treturn {\r\n\t\t\t\tsocket:null,\r\n\t\t\t\tuserId:null,\r\n\t\t\t\tname:null,\r\n\t\t\t\tcsId:null,\r\n\t\t\t\tmsgs:[],\r\n\t\t\t\tcontent:''\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\tinitWebsocket:function(){\r\n\t\t\t\t\tif(typeof(WebSocket) == \"undefined\") {\r\n\t\t\t\t\t    console.log(\"您的浏览器不支持WebSocket\");\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t    console.log(\"您的浏览器支持WebSocket\");\r\n\t\t\t\t\t    //实现化WebSocket对象，指定要连接的服务器地址与端口  建立连接\r\n\t\t\t\t\t    // var userId = JSON.parse(localStorage.getItem(\"user\")).id;\r\n\t\t\t\t\t    var socketUrl=\"ws://localhost:8080/ccs/webSocket/\"+this.userId+\"/visitor\";\r\n\t\t\t\t\t    // var socketUrl=\"ws://192.168.0.231:22599/webSocket/\"+userId;\r\n\t\t\t\t\t    console.log(socketUrl);\r\n\t\t\t\t\t    if(this.socket!=null){\r\n\t\t\t\t\t        this.socket.close();\r\n\t\t\t\t\t        this.socket=null;\r\n\t\t\t\t\t    }\r\n\t\t\t\t\t    this.socket = new WebSocket(socketUrl);\r\n\t\t\t\t\t    //打开事件\r\n\t\t\t\t\t    this.socket.onopen = function() {\r\n\t\t\t\t\t        console.log(\"websocket已打开\");\r\n\t\t\t\t\t        //socket.send(\"这是来自客户端的消息\" + location.href + new Date());\r\n\t\t\t\t\t    };\r\n\t\t\t\t\t    //获得消息事件\r\n\t\t\t\t\t    this.socket.onmessage = (resp)=> {\r\n\t\t\t\t\t\t\tdebugger\r\n\t\t\t\t\t        //当接收到websocket服务器发送当消息当时候，判断消息是会话列表有更新还是会话消息有更新，更新对应当子组件\r\n\t\t\t\t\t\t\tlet msg = JSON.parse(resp.data);\r\n\t\t\t\t\t\t\tthis.msgs.push(msg);\r\n\t\t\t\t\t\t\tif(msg.csId){//第一次连接的时候，websocket服务器会返回服务的客服id\r\n\t\t\t\t\t\t\t\tthis.csId = msg.csId;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(msg.sessionId){//第一次连接的时候，websocket服务器会返回会话id\r\n\t\t\t\t\t\t\t\tthis.sessionId = msg.sessionId;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t    };\r\n\t\t\t\t\t    //关闭事件\r\n\t\t\t\t\t    this.socket.onclose = function() {\r\n\t\t\t\t\t        console.log(\"websocket已关闭\");\r\n\t\t\t\t\t    };\r\n\t\t\t\t\t    //发生了错误事件\r\n\t\t\t\t\t    this.socket.onerror = function() {\r\n\t\t\t\t\t        console.log(\"websocket发生了错误\");\r\n\t\t\t\t\t    }\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\tgetId:function(){\r\n\t\t\t\t// 将客户端信息：IP,客户名称，浏览器，屏幕尺寸，设备等信息提交给服务器，服务器返回当前的访客 id\r\n\t\t\t\t let ip = localStorage.getItem(\"ip\");\r\n\t\t\t\t let name=this.name = localStorage.getItem(\"cname\");\r\n\t\t\t\t \r\n\t\t\t\t let uaParser = new UaParser();\r\n\t\t\t\t let uaInfo = uaParser.getResult();\r\n\t\t\t\t let device = uaInfo.os.name;\r\n\t\t\t\t let browser = uaInfo.browser.name;\r\n\t\t\t\t let screenSize = `${window.screen.width}px*${window.screen.height}px`;\r\n\t\t\t\t \r\n\t\t\t\t let params = {\r\n\t\t\t\t\t ip,\r\n\t\t\t\t\t name,\r\n\t\t\t\t\t browser,\r\n\t\t\t\t\t screenSize,\r\n\t\t\t\t\t device\r\n\t\t\t\t }\r\n\t\t\t\t this.$axios\r\n\t\t\t\t .post('/visitor/save',params)\r\n\t\t\t\t .then(resp=>{\r\n\t\t\t\t\t let {data} = resp;\r\n\t\t\t\t\t this.userId = data.success?data.message:\"\";\r\n\t\t\t\t\t this.initWebsocket();\r\n\t\t\t\t })\r\n\t\t\t\t .catch(err=>{\r\n\t\t\t\t\t console.log(err)\r\n\t\t\t\t })\r\n\t\t\t\t \r\n\t\t\t},\r\n\t\t\tsendMsg:function(){\r\n\t\t\t\tlet msg ={\r\n\t\t\t\t\tcontent:this.content,\r\n\t\t\t\t\tmsgSenderId:this.userId,\r\n\t\t\t\t\tmsgSenderName:this.name,\r\n\t\t\t\t\tmsgReceiverId:this.csId,\r\n\t\t\t\t\tsessionId:this.sessionId,\r\n\t\t\t\t\tcreateTime:new Date().format('yyyy-MM-dd hh:mm:ss')\r\n\t\t\t\t}\r\n\t\t\t\tthis.socket.send(JSON.stringify(msg));\r\n\t\t\t\tthis.msgs.push(msg);\r\n\t\t\t\tthis.content=''\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\tthis.getId();\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.session-main-body {\r\n\t\tmargin: auto;\r\n\t\tpadding-top: 1px;\r\n\t\tpadding-bottom: 76px;\r\n\t\twidth: 700px;\r\n\t\tborder-right: 2px solid rgba(242, 242, 242, 0.498);\r\n\t\tbackground-color: white;\r\n\t}\r\n\t\r\n\t.title{\r\n\t\ttext-align: center;\r\n\t\tmargin: 20px;\r\n\t}\r\n\t\r\n\t.session-main-body .session-window {\r\n\t\tbackground-color: rgba(242, 242, 242, 0.6);\r\n\t\theight: 460px;\r\n\t\tpadding: 50px 20px;\r\n\t\toverflow-x: scroll;\r\n\t}\r\n\t.session-main-body .session-window::-webkit-scrollbar{\r\n\t\tdisplay: none;\r\n\t}\r\n\t\r\n\t.session-main-body .session-input {\r\n\t\theight: 147px;\r\n\t}\r\n\t\r\n\t.session-body .session-util-tab {\r\n\t\twidth: 340px;\r\n\t}\r\n\t\r\n\t.session-window .session-msg {\r\n\t\tdisplay: flex;\r\n\t}\r\n\t\r\n\t.session-msg .user-img {\r\n\t\twidth: 40px;\r\n\t\theight: 40px;\r\n\t\tline-height: 40px;\r\n\t\tborder-radius: 50%;\r\n\t\ttext-align: center;\r\n\t\tbackground-color: #006EFF;\r\n\t\tcolor: #FFFFFF;\r\n\t\tmargin-right: 10px;\r\n\t\tmargin-left: 0px;\r\n\t}\r\n\t\r\n\t.session-msg.receiver .user-img {\r\n\t\tmargin-right: 0px;\r\n\t\tmargin-left: 10px;\r\n\t}\r\n\t\r\n\t.session-msg .msg-detail {\r\n\t\tmax-width: 80%;\r\n\t}\r\n\t\r\n\t.session-msg .msg-title {\r\n\t\tcolor: #aeaeae;\r\n\t\tmargin-bottom: 6px;\r\n\t}\r\n\t\r\n\t.session-msg .msg-content {\r\n\t\tpadding: 10px 12px;\r\n\t\tbackground-color: #fff;\r\n\t\tbox-shadow: rgb(204, 204, 204) 0px 0px 5px 0px;\r\n\t\tborder-radius: 4px;\r\n\t\tmargin-bottom: 20px;\r\n\t}\r\n\t\r\n\t.session-msg.receiver {\r\n\t\tflex-direction: row-reverse;\r\n\t}\r\n\t\r\n\t.session-input {\r\n\t\tpadding-left: 10px;\r\n\t}\r\n\t\r\n\t.session-input .icon-img {\r\n\t\theight: 30px;\r\n\t\tline-height: 30px;\r\n\t\tmargin-bottom: 12px;\r\n\t}\r\n\t\r\n\t.session-input .icon-img i {\r\n\t\tfont-size: 20px;\r\n\t\tcolor: rgba(0, 0, 0, .6);\r\n\t}\r\n\t\r\n\t.session-input .icon-img span {\r\n\t\tmargin-right: 23px;\r\n\t}\r\n\t\r\n\t.session-input .input-box {\r\n\t\theight: 120px;\r\n\t}\r\n\t\r\n\t.input-box textarea {\r\n\t\theight: 100%;\r\n\t\twidth: 100%;\r\n\t\tborder-style: none;\r\n\t}\r\n\t.input-box textarea:focus{\r\n\t\toutline: none;\r\n\t}\r\n\t\r\n\t.input-btn {\r\n\t\ttext-align: right;\r\n\t}\r\n\t\r\n\t.input-btn button {\r\n\t\tbackground-color: #006EFF;\r\n\t\tcolor: #fff;\r\n\t\tborder-style: none;\r\n\t\tmargin-right: 16px;\r\n\t\tmargin-top: 6px;\r\n\t\twidth: 100px;\r\n\t\theight: 40px;\r\n\t\tborder-radius: 4px;\r\n\t}\r\n</style>\r\n"],"sourceRoot":"src/pages/visitor"}]}